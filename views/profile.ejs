<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PureInsight - Account</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/feather-icons"></script>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Parkinsans:wght@300..800&display=swap");
            * {
                font-family: "Parkinsans";
            }
        </style>
        <!-- Add after the existing head content -->
        <link
            rel="stylesheet"
            type="text/css"
            href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
        />
        <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/toastify-js"
        ></script>
    </head>
    <body class="bg-white max-w-screen-xl mx-auto px-4 sm:px-8 py-6">
        <%- include('partials/nav') %>

        <div class="max-w-2xl mx-auto mt-10">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">
                Update Profile
            </h1>
            <form id="updateProfileForm" method="POST" class="space-y-6">
                <!-- Name -->
                <div>
                    <label
                        for="name"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Name</label
                    >
                    <input
                        type="text"
                        id="name"
                        name="name"
                        value="<%= locals.user.name %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        required
                    />
                </div>

                <!-- Allergies -->
                <div>
                    <label
                        for="allergies"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Allergies (comma-separated)</label
                    >
                    <input
                        type="text"
                        id="allergies"
                        name="allergies"
                        value="<%= locals.user.allergies %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>

                <!-- Illness -->
                <div>
                    <label
                        for="illness"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Illness (comma-separated)</label
                    >
                    <input
                        type="text"
                        id="illness"
                        name="illness"
                        value="<%= locals.user.illness %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>

                <!-- Skin Type -->
                <div>
                    <label
                        for="skin"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Skin Type</label
                    >
                    <input
                        type="text"
                        id="skin"
                        name="skin"
                        value="<%= locals.user.skin %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>

                <!-- Height -->
                <div>
                    <label
                        for="height"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Height (in cm)</label
                    >
                    <input
                        type="number"
                        id="height"
                        name="height"
                        value="<%= locals.user.height %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>

                <!-- Weight -->
                <div>
                    <label
                        for="weight"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Weight (in kg)</label
                    >
                    <input
                        type="number"
                        id="weight"
                        name="weight"
                        value="<%= locals.user.weight %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>

                <!-- Meal Frequency -->
                <div>
                    <label
                        for="meal"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Meal Frequency</label
                    >
                    <input
                        type="number"
                        id="meal"
                        name="meal"
                        value="<%= locals.user.meal %>"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                </div>

                <!-- Goals -->
                <div>
                    <label
                        for="goals"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Goals</label
                    >
                    <textarea
                        id="goals"
                        name="goals"
                        rows="3"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
<%= locals.user.goals %></textarea
                    >
                </div>

                <div>
                    <label
                        for="activity"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Activity Level</label
                    >
                    <select id="activity" name="activityLevel"  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                      <option value="" disabled <%= !locals.user.activityLevel ? 'selected' : '' %>>Select your activity level</option>
                      <option value="sedentary" <%= locals.user.activityLevel === 'sedentary' ? 'selected' : '' %>>Sedentary</option>
                      <option value="lightly_active" <%= locals.user.activityLevel === 'lightly_active' ? 'selected' : '' %>>Lightly Active</option>
                      <option value="moderately_active" <%= locals.user.activityLevel === 'moderately_active' ? 'selected' : '' %>>Moderately Active</option>
                      <option value="very_active" <%= locals.user.activityLevel === 'very_active' ? 'selected' : '' %>>Very Active</option>
                      <option value="super_active" <%= locals.user.activityLevel === 'super_active' ? 'selected' : '' %>>Super Active</option>
                    </select>                    
                </div>

                <div>
                    <label
                        for="gender"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Gender</label
                    >
                    <select id="gender" name="gender"  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                      <option value="" disabled <%= !locals.user.gender ? 'selected' : '' %>>Select your gender</option>
                      <option value="male" <%= locals.user.gender === 'male' ? 'selected' : '' %>>Male</option>
                      <option value="female" <%= locals.user.gender === 'female' ? 'selected' : '' %>>Female</option>
                      <option value="non_binary" <%= locals.user.gender === 'non_binary' ? 'selected' : '' %>>Non-Binary</option>
                      <option value="" <%= !locals.user.gender ? 'selected' : '' %>>Prefer not to say</option>
                    </select>                    
                </div>

                <div>
                    <label
                        for="age_group"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Age Group</label
                    >
                    <select id="age_group" name="ageGroup"  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                      <option value="" disabled <%= !locals.user.age_group ? 'selected' : '' %>>Select your age group</option>
                      <option value="child" <%= locals.user.ageGroup === 'child' ? 'selected' : '' %>>Child (0-12)</option>
                      <option value="teen" <%= locals.user.ageGroup === 'teen' ? 'selected' : '' %>>Teen (13-19)</option>
                      <option value="adult" <%= locals.user.ageGroup === 'adult' ? 'selected' : '' %>>Adult (20-59)</option>
                      <option value="senior" <%= locals.user.ageGroup === 'senior' ? 'selected' : '' %>>Senior (60+)</option>
                    </select>                    
                </div>

                <div>
                    <label
                        for="dietary_restriction"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Dietary Restriction</label
                    >
                    <select id="dietary_restriction" name="dietaryRestriction"  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                      <option value="" disabled <%= !locals.user.dietaryRestriction ? 'selected' : '' %>>Select your dietary preference</option>
                      <option value="vegan" <%= locals.user.dietaryRestriction === 'vegan' ? 'selected' : '' %>>Vegan</option>
                      <option value="vegetarian" <%= locals.user.dietaryRestriction === 'vegetarian' ? 'selected' : '' %>>Vegetarian</option>
                      <option value="non_vegetarian" <%= locals.user.dietaryRestriction === 'non_vegetarian' ? 'selected' : '' %>>Non-Vegetarian</option>
                    </select>                    
                </div>

                <button
                    type="submit"
                    class="w-full bg-green-700 text-white py-2 px-4 rounded-md hover:bg-green-800 transition-colors"
                >
                    Update Profile
                </button>
            </form>
        </div>

        <script>
            document
                .getElementById("updateProfileForm")
                .addEventListener("submit", async (event) => {
                    event.preventDefault();

                    const formData = new FormData(event.target);
                    const data = Object.fromEntries(formData.entries());

                    try {
                        const response = await fetch("/profile", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data),
                        });

                        const result = await response.json();
                        if (result.success) {
                            alert("Profile updated successfully!");
                            window.location.reload();
                        } else {
                            alert(`Error: ${result.message}`);
                        }
                    } catch (error) {
                        console.error("Error updating profile:", error);
                    }
                });
        </script>
        <script src="/js/common.js"></script>
    </body>
</html>
